
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .modal {
        overflow-y: auto;
    }
</style>




<div class="row m-4">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <center> Proyecto Mapas</center>
            </div>
            <div class="card-body">

                <div class="row">
                    <div class="col-9">

                    </div>
                    <div class="col-3">
                        Tipo de seleccion mapa
                        <select class="form-control" name="tipo_filtro_mapa" id="tipo_filtro_mapa" required="">
                            <option value="TODO" selected="">
                                TODO
                            </option>
                            <option value="FILTRO">
                                FILTRO
                            </option>
                        </select>
                    </div>


                </div>

                <br />

                <table class="display responsive nowrap" id="myTable" style="width:100%">
                    <thead>
                        <tr>
                            <th>IDC</th>
                            <th>Nombre</th>
                            <th>Ubicacion</th>
                            <th>Latitud</th>
                            <th>Longitud</th>
                            <th></th>
                        </tr>
                    </thead>

                </table>

                <div class="form-group mt-3">
                    <div id="Mapa2" style="width:100% ; height:300px;"></div>
                </div>
            </div>

        </div>

    </div>

</div>


<!-- Modal Editar datos -->
<div class="modal fade" id="FormModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="row col-12">
                    <div class="col-6">
                        <h5 id="exampleModalLabel">Creacion de Garantias</h5>
                    </div>

                    <div class="col-6" style="display: flex">
                        <div class="col-6">
                            <label for="cmbCadena">Cadena</label>
                            <select id="cmbCadena">
                         >
                            </select>
                        </div>
                        <div class="col-6">
                            <label for="cmbSegmento">Segmento</label>
                            <select id="cmbSegmento">
                            
                            </select>
                        </div>
                    </div>

                </div>




            </div>
            <div class="modal-body">


                <div class="row">

                    <div class="col-sm-10" style=" margin-bottom: 20px;">
                    </div>

                    <div class="col-sm-2" style=" margin-bottom: 20px;">
                        <button type="button" class="col-sm-12 btn btn-info" onclick="consultarBusqueda()"><i class="fas fa-search"></i> Buscar </button>
                    </div>


                    <div class="col-sm-6">

                        <div class="form-group">
                            <div id="ModalMapPreview" style="width:100% ; height:600px;"></div>
                        </div>

                    </div>





                    <div class="col-sm-6">


                        <input type="hidden" id="txtIdCliente" />



                        <div class="row">
                            <div class="col">
                                <label for="txtIDC">Identificacion de Cliente:</label>
                                <input type="text" class="form-control" placeholder="IDC" id="txtIDC">
                            </div>

                            <div class="col">
                                <label for="txtNombre">Nombre de Cliente:</label>
                                <input type="text" class="form-control" placeholder="Nombre" id="txtNombre">
                            </div>

                        </div>

                        <div class="row">

                            <div class="col">
                                <label for="txtLat">Latitud:</label>
                                <input type="text" class="form-control" id="txtLat">
                            </div>


                            <div class="col">
                                <label for="txtLong">Longitud:</label>
                                <input type="text" class="form-control" id="txtLong">
                            </div>


                        </div>

                        <div class="row">


                            <div class="col">
                                <label for="txtUbicacion">Ubicacion</label>
                                <input class="form-control" type="text" id="txtUbicacion" />

                            </div>

                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="txtTipoReg">Tipo de Registro</label>
                                    <select class="custom-select mr-sm-2" id="txtTipoReg">

                                        <option value="1">Garantia</option>
                                        <option value="2">Agricola</option>

                                    </select>
                                </div>
                            </div>


                        </div>



                        <div class="row">


                            <div class="col">
                                <label for="txtNumG">Num. Gta</label>
                                <input class="form-control" type="text" id="txtNumG" />

                            </div>


                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="txtTipPre">Tipo de Predio:</label>
                                    <select class="custom-select mr-sm-2" id="txtTipPre">

                                        <option value="1">Agricola</option>
                                        <option value="2">nose</option>

                                    </select>
                                </div>
                            </div>



                        </div>


                        <div class="row">

                            <div class="form-row align-items-center">
                                <div class="col-auto my-1">
                                    <label class="mr-sm-2" for="txtConUs">Tipo de Predio:</label>
                                    <select class="custom-select mr-sm-2" id="txtConUs">

                                        <option value="1">Propietario</option>
                                        <option value="2">alquiler</option>

                                    </select>
                                </div>
                            </div>

                            <div>
                                <label for="txtFecha">Fecha:</label>
                                <input class="form-control" type="date" id="txtFecha">

                            </div>


                        </div>


                        <div class="row">

                            <div class="col">
                                <label for="txtValC">Valor Comercial:</label>
                                <input class="form-control" type="text" id="txtValC" />

                            </div>

                            <div class="col">
                                <label for="txtSupTo">Superficie Total:</label>
                                <input class="form-control" type="number" id="txtSupTo" />

                            </div>

                            <div class="col">
                                <label for="txtUS">US$/Ha:</label>
                                <input class="form-control" type="number" id="txtUS" />

                            </div>

                        </div>


                        <div class="row">


                            <div class="col">
                                <label for="txtSupAg">Sup. Agricola Habilitadas:</label>
                                <input class="form-control" type="number" id="txtSupAg" />

                            </div>


                            <div class="col">
                                <label for="txtSupGan">Sup. Ganadera Habilitadas:</label>
                                <input class="form-control" type="number" id="txtSupGan" />

                            </div>


                        </div>


                        <div class="row">


                            <div class="col">
                                <label for="txtSucursal">Sucursal:</label>
                                <input class="form-control" type="text" id="txtSucursal" />

                            </div>


                            <div class="col">
                                <label for="txtRegion">Region</label>
                                <select class="form-control" id="txtRegion">
                                    <option value="Occidente">Occidente</option>
                                    <option value="Centro">Centro</option>
                                    <option value="Oriente">Oriente</option>
                                </select>

                            </div>


                        </div>


                        <div class="row">


                            <div class="col">
                                <label for="txtObs">Observaciones:</label>
                                <input class="form-control" type="text" id="txtObs" />

                            </div>

                        </div>

                    </div>


                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="Guardar()">Guardar</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal vista datos -->
<div class="modal fade" id="FormModalVista" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Tiendas</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">


                <div class="row" style="margin:20px">
                    <div style="display: block;overflow-x: auto;white-space: nowrap;">
                        <table class="display responsive" id="myTable2" style="display: block;overflow-x: auto;white-space: nowrap;">
                            <thead>
                                <tr>
                                    <th>RUC</th>
                                    <th>Razon Social</th>
                                    <th>Region</th>
                                    <th>Sucursal</th>
                                    <th>Cadena</th>
                                    <th>Segmento</th>
                                </tr>
                            </thead>
                        </table>

                    </div>

                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>


@section scripts{

    <script src="~/Scripts/moment.js"></script>

    <!-- Codigo de mapas -->
    <script>
        var vMarker
        var map

        function iniciarMapas() {

            mapaListado = cargarMapa('Mapa2');
            mapaDetalle = cargarMapa('ModalMapPreview');
            configurarMarcadorPuntos(mapaDetalle);
        }

        $.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyAxFURWRz0_MMd6tRc0jIkEZikkb5_YI70&callback=iniciarMapas")
            .done(function (script, textStatus) {
                refrescarListadoMapa();
            })
            .fail(function (jqxhr, settings, exception) {
                console.log("Triggered ajaxError handler.");
            });


        function cargarPuntosGps(map) {
          $.ajax({
            url: "@Url.Action("ListarClientes", "Garantia")",
            type: 'GET',
            dataType: 'json',
            success: function (json) {
                cargarListadoPuntos(map,json.data);
            },
            error: function (xhr, status) {
                alert('Disculpe, existió un problema');
            }
          });
        }

        function cargarMapa(idElement) {
            map = new google.maps.Map(document.getElementById(idElement), {
                zoom: 6,
                center: new google.maps.LatLng(-17.809512, -63.199832),
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            return map;
        }

        function cargarMapaPuntos(idElement,lat,lon) {
            map = new google.maps.Map(document.getElementById(idElement), {
                zoom: 6,
                center: new google.maps.LatLng(lat, lon),
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            return map;
        }

        function configurarMarcadorPuntos(map) {
            vMarker = new google.maps.Marker({
                position: new google.maps.LatLng(-17.809512, -63.199832),
                draggable: true
            });

            google.maps.event.addListener(vMarker, 'dragend', function (evt) {
                $("#txtLat").val(evt.latLng.lat().toFixed(6));
                $("#txtLong").val(evt.latLng.lng().toFixed(6));

                map.panTo(evt.latLng);
            });

            map.setCenter(vMarker.position);
            vMarker.setMap(map);
        }

        function configurarMarcadorPuntosMapa(map,lat,lon) {
            vMarker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lon),
                draggable: true
            });

            google.maps.event.addListener(vMarker, 'dragend', function (evt) {
                $("#txtLat").val(evt.latLng.lat().toFixed(6));
                $("#txtLong").val(evt.latLng.lng().toFixed(6));

                map.panTo(evt.latLng);
            });

            map.setCenter(vMarker.position);
            vMarker.setMap(map);
        }

        function cargarListadoPuntos(map, data) {
            var infowindow;
            for (i = 0; i < data.length; i++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(data[i].Latitud, data[i].Longitud),
                    map: map
                });
                (function (i, marker) {
                    google.maps.event.addListener(marker, 'click', function () {
                        if (!infowindow) {
                            infowindow = new google.maps.InfoWindow();
                        }
                        infowindow.setContent("IDC: " + data[i].IDC +"<br/>Nombre de Cliente: " + data[i].Nombre + "<br/>Ubicacion: " + data[i].Ubicacion);
                        infowindow.open(map, marker);
                    });
                })(i, marker);
            }

        }

    </script>
    <!-- Final Codigo de mapas -->
    <!-- Codigo de validaciones -->
    <script>

        $("#txtValC").on({
            "focus": function (event) {
                $(event.target).select();
            },
            "keyup": function (event) {
                $(event.target).val(function (index, value) {
                    return value.replace(/\D/g, "")
                        .replace(/([0-9])([0-9]{2})$/, '$1.$2')
                        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",");
                });
            }
        });

    </script>
    <!-- Final Codigo de validaciones -->
    <!-- Codigo de carga de datos -->
    <script>

        $(document).ready(function () {

            $('#cmbCadena').on('change', function () {
                verificarComboCadenaSegmento();
            });

            $('#cmbSegmento').on('change', function () {
                verificarComboCadenaSegmento();
            });

        });


        function verificarComboCadenaSegmento()
        {
            var $valorCmbCadena = '';
            var $valorCmbSegmento = '';

            $valorCmbCadena = $('#cmbCadena').val().toLowerCase();
            $valorCmbSegmento = $('#cmbSegmento').val().toLowerCase();

            if ($valorCmbCadena.toLowerCase() === 'agricultura' && $valorCmbSegmento.toLowerCase() === 'produccion') {
                $('#txtSupAg').attr('readonly', true);
                $('#txtSupGan').attr('readonly', true);
                $('#txtSupAg').val('');
                $('#txtSupGan').val('');
            } else {
                $('#txtSupAg').attr('readonly', false);
                $('#txtSupGan').attr('readonly', false);
            }
        }

        var tabla_persona;
         $(document).ready( function () {
             tabla_persona = $('#myTable').DataTable({
                 "ajax": {
                    "url": "@Url.Action("ListarClientes", "Garantia")",
                    "type": "GET",
                    "datatype": "json"
                },
                 "columns": [
                    { "data": "IDC" },
                    { "data": "Nombre" },
                    { "data": "Ubicacion" },
                    { "data": "Latitud" },
                    { "data": "Longitud" },
                    {
                        "data": "idCliente", "render": function (data) {
                            return "<button class='btn btn-primary btn-sm editar' type='button' onclick='abrirModal(" + data + ")'><i class='fas fa-pen'></i></button>" +
                                "<button class='btn btn-danger btn-sm ml-2 eliminar' type='button'  onclick='Eliminar(" + data + ")'><i class='fa fa-trash'></i></button>"
                     },
                        "orderable": false,
                        "searchable": false,
                        "width": "150px"
                    }
                ],
                 dom: 'Bfrtip',
                buttons: [
                    {
                        text: 'Agregar Nuevo',
                        attr: { class: 'btn btn-success btn-sm' },
                        action: function (e, dt, node, config) {
                            abrirModal(0)
                        }
                    },
                    {
                        text: 'Exportar a excel',
                        attr: { class: 'btn btn-info btn-sm' },
                        action: function () {
                            exportarExcel()
                        }
                    },
                    {
                        text: 'Limpiar seleccion',
                        attr: {
                            class: 'btn btn-dark btn-sm limpiar', style:'background-color: darkgoldenrod;' },
                        action: function (e, dt, node, config) {
                            limpiarSeleccion()
                        }
                    },
                 ],
                 "language": {
                     "url": "@Url.Content("~/Content/datatable/idioma/datatable.es-ES.json")"
                 }

            });
         });

        var tabla_persona2;
         $(document).ready( function () {
             tabla_persona2 = $('#myTable2').DataTable({
                 "ajax": {
                    "url": "@Url.Action("ListarVistaGarantia", "Garantia")",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "IDCn" },
                    { "data": "Nombres" },
                    { "data": "region" },
                    { "data": "sucursal" },
                    { "data": "cadena" },
                    { "data": "segmento" },
                    {
                         "render": function (data, type, row) {
                            return '<button class="btn btn-primary btn-sm" type="button" onclick="cargarDatosCliente(' + "'" + row['IDCn'] + "'" + ",'" + row['Nombres'] + "'" + ",'" + row['sucursal'] + "','" + row['region'] + "','" + row['cadena']  + "','" + row['segmento'] + "'"  +')">Seleccionar</button>'

                        },
                        "orderable": false,
                        "searchable": false,
                        "width": "150px"
                    }
                ],
                 dom: 'Bfrtip',
                 buttons: [

                 ],
                 "language": {
                     "url": "@Url.Content("~/Content/datatable/idioma/datatable.es-ES.json")"
                 }

            });
         });

        function refrescarListadoMapa() {
            mapaListado = cargarMapa('Mapa2');
            cargarPuntosGps(mapaListado);
        }

        function refrescarListadoMapaRegistrosSeleccionados(data) {
            mapaListado = cargarMapa('Mapa2');
            cargarListadoPuntos(mapaListado, data);
        }

        function abrirModal($idcliente) {

            $("#txtIdCliente").val($idcliente);
            if ($idcliente != 0) {

                jQuery.ajax({
                    url: "@Url.Action("ObtnerPorIdCliente", "Garantia")" + "?idcliente=" + $idcliente,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {

                        if (data != null) {
                            $("#txtIDC").val(data.IDC);
                            $("#txtNombre").val(data.Nombre);
                            $("#txtLat").val(data.Latitud);
                            $("#txtLong").val(data.Longitud);
                            $("#txtUbicacion").val(data.Ubicacion);
                            $("#txtTipoReg").val(data.TipoReg);
                            $("#txtNumG").val(data.NumGa);
                            $("#txtTipPre").val(data.TipoPre);
                            $("#txtConUs").val(data.CondUso);
                            $("#txtFecha").val(moment(data.avaluo).format('YYYY-MM-DD'));
                            $("#txtValC").val(data.valCom);
                            $("#txtSupTo").val(data.supTot);
                            $("#txtUS").val(data.supUsa);
                            $("#txtSupAg").val(data.SupAgHab);
                            $("#txtSupGan").val(data.SupGaHab);
                            $("#txtObs").val(data.obs);
                            $("#txtSucursal").val(data.sucursal);
                            $("#txtRegion").val(data.region);
                            var map = cargarMapaPuntos('ModalMapPreview', data.Latitud, data.Longitud);
                            configurarMarcadorPuntosMapa(map, data.Latitud, data.Longitud);
                        }

                    }
                });
            } else {


                $("#txtIDC").val("");
                $("#txtNombre").val("");
                $("#txtLat").val("");
                $("#txtLong").val("");
                $("#txtUbicacion").val("");
                $("#txtTipoReg").val("");
                $("#txtNumG").val("");
                $("#txtTipPre").val("");
                $("#txtConUs").val("");
                $("#txtFecha").val(moment(new Date()).format("YYYY-MM-DD"));
                $("#txtValC").val("");
                $("#txtSupTo").val("");
                $("#txtUS").val("");
                $("#txtSupAg").val("");
                $("#txtSupGan").val("");
                $("#txtObs").val("");
                $("#txtSucursal").val("");
                $("#txtRegion").val("");
            }

            $('#FormModal').modal('show');

            var map = cargarMapaPuntos('ModalMapPreview', "-16.191613", "-64.496218");
            configurarMarcadorPuntosMapa(map, "-16.191613", "-64.496218");

        }

        function Guardar() {

            var $data = {
                oCliente: {
                    idCliente: parseInt($("#txtIdCliente").val()),
                    IDC: $("#txtIDC").val(),
                    Nombre: $("#txtNombre").val(),
                    Ubicacion: $("#txtUbicacion").val(),
                    Latitud: $("#txtLat").val(),
                    Longitud: $("#txtLong").val(),
                    TipoReg: $("#txtTipoReg").val(),
                    NumGa: $("#txtNumG").val(),
                    TipoPre: $("#txtTipPre").val(),
                    CondUso: $("#txtConUs").val(),
                    avaluo: $("#txtFecha").val(),
                    valCom: parseInt($("#txtValC").val()),
                    supTot: parseInt($("#txtSupTo").val()),
                    supUsa: parseInt($("#txtUS").val()),
                    SupAgHab: parseInt($("#txtSupAg").val()),
                    SupGaHab: parseInt($("#txtSupGan").val()),
                    obs: $("#txtObs").val(),
                    sucursal: $("#txtSucursal").val(),
                    region: $("#txtRegion").val(),
                    cadena: $("#cmbCadena").val(),
                    segmento: $("#cmbSegmento").val(),
                }
            }

            jQuery.ajax({
                url: "@Url.Action("Guardar", "Garantia")",
                type: "POST",
                data: JSON.stringify($data),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    if (data.resultado) {
                        tabla_persona.ajax.reload();
                        $('#FormModal').modal('hide');
                        refrescarListadoMapa();
                    } else {
                        alert("No se pudo guardar los cambios");
                    }
                },
                error: function (error) {
                    console.log(error)
                },
                beforeSend: function () {

                }
            });

        }

        function Eliminar($idpersona) {
            if (confirm("¿Realmente desea eliminar?")) {
                var $data = {
                    idCliente: $idpersona,
                };
                jQuery.ajax({
                    url: "@Url.Action("Eliminar", "Garantia")",
                    type: "POST",
                    data: JSON.stringify($data),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data, textStatus, jqXHR) {

                        if (data.resultado) {
                            tabla_persona.ajax.reload();
                        }
                    }
                });


            }
        }

        function exportarExcel() {
            window.location.href = "@Url.Action("exportExcel", "Garantia")";
        }

        function consultarBusqueda() {
            $('#FormModalVista').modal('show');
            $('#FormModal').modal('hide');
              tabla_persona2.ajax.reload();
        }


        function cargarDatosCliente(IDCn, Nombres, sucursal, region,cadena, segmento) {

            $("#txtIdCliente").val(0);
            $("#txtIDC").val(IDCn);
            $("#txtNombre").val(Nombres);
            $("#txtLat").val("");
            $("#txtLong").val("");
            $("#txtUbicacion").val("");
            $("#txtTipoReg").val("");
            $("#txtNumG").val("");
            $("#txtTipPre").val("");
            $("#txtConUs").val("");
            $("#txtFecha").val(moment(new Date()).format('YYYY-MM-DD'));
            $("#txtValC").val("");
            $("#txtSupTo").val("");
            $("#txtUS").val("");
            $("#txtSupAg").val("");
            $("#txtSupGan").val("");
            $("#txtObs").val("");
            $("#txtSucursal").val(sucursal);
            $("#txtRegion").val(region);
            $("#cmbCadena").val(cadena.toLowerCase());
            $("#cmbSegmento").val(segmento.toLowerCase());

            $('#FormModal').modal('show');
            $('#FormModalVista').modal('hide');

            verificarComboCadenaSegmento();
        }


         function obtenerCadenas() {
            return  $.ajax({
            url: "@Url.Action("ListarCadenas", "Garantia")",
            type: 'GET',
                dataType: 'json',
            }).then(response => response.data);
        }

        function obtenerSegmentos() {
            return  $.ajax({
            url: "@Url.Action("ListarSegmentos", "Garantia")",
            type: 'GET',
                dataType: 'json',
            }).then(response => response.data);
        }

        async function cargarComboSegmento() {
            var datos = await obtenerSegmentos()
       
            var $dropdown = $("#cmbSegmento");
            $.each(datos, function () {
                $dropdown.append($("<option />").val(this.descripcion).text(this.descripcion));
            });
        }

        async function cargarComboCadena() {
            var datos = await obtenerCadenas()

            var $dropdown = $("#cmbCadena");
            $.each(datos, function () {
                $dropdown.append($("<option />").val(this.descripcion).text(this.descripcion));
            });
        }

        cargarComboSegmento();
        cargarComboCadena();


    </script>
    <!-- Final Codigo de carga de datos -->
    <!-- Codigo de seleccion de puntos gps -->
    <script>
        $(document).ready(function () {
            $('#tipo_filtro_mapa').on('change', function () {
                if (this.value == "TODO") {
                    limpiarSeleccion();
                    refrescarListadoMapa();
                } else {
                    mapaListado = cargarMapa('Mapa2');
                }
            });

        });

        $("#myTable").on("click", "td", function () {
            if ($(this).has('button').length == 0) {
                var tipoFiltroMapa = $('#tipo_filtro_mapa').find(":selected").val();

                if (tipoFiltroMapa != "TODO") {
                    var tr = $(this).closest('tr');
                    tr.toggleClass('selected');
                    cargarRegistrosSeleccionados();
                }
            }
        });

        $('#FormModal').on('hidden.bs.modal', function () {
            var tipoFiltroMapa = $('#tipo_filtro_mapa').find(":selected").val();

            if (tipoFiltroMapa == "TODO") {
                refrescarListadoMapa();
            }

        });

        function limpiarSeleccion() {
            $('.selected').each(function () {
                $(this).toggleClass('selected');
                mapaListado = cargarMapa('Mapa2');
            });

        }

        function cargarRegistrosSeleccionados() {
            mapaListado = cargarMapa('Mapa2');
            $('.selected td:first-child').each(function () {
                var table = $('#myTable').DataTable();
                arrayResultado = [];
                var tabla = table.rows('#myTable');

                for (i = 0; i < table.data().length; i++) {
                    row = tabla.row(i);

                    var nombreClase = row.node().className;

                    if (nombreClase.includes('selected')) {
                        var datosRow = row.data();
                        arrayResultado.push(datosRow);
                    }
                }

                refrescarListadoMapaRegistrosSeleccionados(arrayResultado);
            });
        }

    </script>
    <!-- Final Codigo de seleccion de puntos gps -->

}


